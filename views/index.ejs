<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
  <!-- Meta Tags -->
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="author" content="YooKits" />
  <!-- Page Title -->
  <title>Dashboard</title>
  <!-- Favicon Icon -->
  <link rel="icon" href="assets/img/favicon.png" />
  <!-- CSS -->
  <link rel="stylesheet" type="text/css" href="assets/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="assets/css/jqvmap.min.css" />
  <link rel="stylesheet" type="text/css" href="assets/css/iDashboard.css" />
  <link rel="stylesheet" href="assets/css/toastr.min.css" />
</head>

<body>
  <div class="yoo-height-b60 yoo-height-lg-b60"></div>
  <header class="yoo-header yoo-style1 yoo-sticky-menu">
    <div class="yoo-main-header">
      <div class="yoo-main-header-in">
        <div class="yoo-main-header-left">
          <a href="/" class="yoo-logo-link yoo-light-logo">
            <h3 style="color: white; margin: 0;">iApache2</h3>
          </a>
        </div>
      </div>
    </div>
  </header>
  <!-- .yoo-header -->
  <div class="yoo-sidebarheader-toggle">
    <div class="yoo-button-bar1"></div>
    <div class="yoo-button-bar2"></div>
    <div class="yoo-button-bar3"></div>
  </div>
  <!-- .yoo-sidebarheader-toggle -->
  <div class="yoo-sidebarheader">
    <div class="yoo-sidebarheader-in" data-scrollbar>
      <div class="yoo-sidebar-nav">
        <ul class="yoo-sidebar-nav-list yoo-mp0">
          <li class="active">
            <a href="/">
              <span class="yoo-sidebar-link-title">
                <span class="yoo-sidebar-link-icon yoo-style1">
                  <ion-icon name="layers"></ion-icon>
                </span>
                <span class="yoo-sidebar-link-text">Dashboard</span>
              </span>
            </a>
          </li>
          <li>
            <a href="/createNew">
              <span class="yoo-sidebar-link-title">
                <span class="yoo-sidebar-link-icon yoo-style1">
                  <ion-icon name="create-outline"></ion-icon>
                </span>
                <span class="yoo-sidebar-link-text">Create VirtualHost</span>
              </span>
            </a>
          </li>
        </ul>
        <!-- .yoo-sidebar-nav-list -->
      </div>
    </div>
  </div>

  <div class="yoo-content yoo-style1">
    <div class="yoo-height-b30 yoo-height-lg-b30"></div>
    <div class="container-fluid">
      <div class="yoo-uikits-heading">
        <h2 class="yoo-uikits-title">Dashboard</h2>
      </div>
    </div>
    <div class="yoo-height-b30 yoo-height-lg-b30"></div>
    <div class="container-fluid">
      <div class="row">
        <div class="col-xl-6 col-sm-6">
          <div class="yoo-iconbox yoo-style1 yoo-color1 yoo-blue-bg yoo-blue-shadow">
            <div class="yoo-iconbox-in">
              <div class="yoo-iconbox-title">MODULES LOADED</div>
              <div class="yoo-iconbox-number"><%= modules.length %></div>
              <!-- <div class="yoo-iconbox-footer"><span class="yoo-iconbox-percentage"><ion-icon name="caret-up"></ion-icon>17%</span>Since last week</div> -->
              <div class="yoo-iconbox-icon">
                <ion-icon name="albums"></ion-icon>
              </div>
            </div>
          </div>
          <div class="yoo-height-b30 yoo-height-lg-b30"></div>
        </div>
        <div class="col-xl-6 col-sm-6">
          <div class="yoo-iconbox yoo-style1 yoo-color1 yoo-gray-bg yoo-gray-shadow">
            <div class="yoo-iconbox-in">
              <div class="yoo-iconbox-title">VIRTUALHOSTS</div>
              <div class="yoo-iconbox-number"><%= virtualhosts.length %></div>
              <div class="yoo-iconbox-icon">
                <ion-icon name="layers"></ion-icon>
              </div>
            </div>
          </div>
          <div class="yoo-height-b30 yoo-height-lg-b30"></div>
        </div>
        <!-- .col -->
        <div class="col-xl-12 col-sm-12">
          <div class="yoo-iconbox yoo-style1 yoo-color1 yoo-light-blue-bg yoo-light-blue-shadow">
            <div class="yoo-iconbox-in">
              <div class="yoo-iconbox-title">STATUS</div>
              <div class="yoo-iconbox-number" style="font-size: 20px;">
                <%= status || '-' %>
              </div>
              <div class="yoo-iconbox-footer">
                <button type="button" ripple="ripple" ripple-color="#fff" class="btn btn-warning"
                  onclick="reloadApache()">
                  <ion-icon name="reload-outline"></ion-icon> Reload apache2
                </button>
              </div>
              <div class="yoo-iconbox-icon">
                <ion-icon name="file-tray"></ion-icon>
              </div>
            </div>
          </div>
          <div class="yoo-height-b30 yoo-height-lg-b30"></div>
        </div>
      </div>
      <div class="row">
        <div class="col-lg-4">
          <div class="yoo-card yoo-style1">
            <div class="yoo-card-heading">
              <div class="yoo-card-heading-left">
                <h2 class="yoo-card-title">
                  <span class="yoo-card-title-icon yoo-purple-bg">
                    <ion-icon name="flask" role="img" class="md hydrated" aria-label="flask"></ion-icon>
                  </span>MODULES LOADED
                </h2>
              </div>
            </div>
            <div class="yoo-card-body">
              <div class="yoo-padd-lr-20">
                <div class="yoo-height-b20 yoo-height-lg-b20"></div>
                <ul class="yoo-list-group yoo-style1 yoo-type1 yoo-mp0">
                  <% for(var i = 0; i < modules.length; i++) { %> <% const
                    badge = modules[i].match(/\(([^)]+)\)/)[1] %>
                  <li>
                    <div class="yoo-medias yoo-style1 yoo-type1">
                      <div class="yoo-media-img">
                        <div class="yoo-box-md yoo-radious10 yoo-img-box yoo-purple-box">
                          <img src="assets/img/module.png" alt="Module image" />
                        </div>
                      </div>
                      <div class="yoo-media-meta">
                        <div class="yoo-height-b5 yoo-height-lg-b5"></div>
                        <h2 class="yoo-media-title yoo-margin-bottom-0 yoo-margin-top-2">
                          <%= modules[i].replace(` (${badge})`, "") %>
                        </h2>
                        <!-- <div class="yoo-media-subtitle">dc@gmail.com</div> -->
                      </div>
                      <span class="badge badge-success"><%= badge %></span>
                    </div>
                  </li>
                  <% } %>
                </ul>
                <div class="yoo-height-b20 yoo-height-lg-b20"></div>
              </div>
            </div>
          </div>
          <!-- .yoo-card -->
          <div class="yoo-height-b30 yoo-height-lg-b30"></div>
        </div>
        <div class="col-lg-8">
          <div class="yoo-card yoo-style1">
            <div class="yoo-card-heading">
              <div class="yoo-card-heading-left">
                <h2 class="yoo-card-title">
                  <span class="yoo-card-title-icon yoo-green-bg">
                    <ion-icon name="cube"></ion-icon>
                  </span>VIRTUALHOSTS
                </h2>
              </div>
            </div>
            <div class="yoo-card-body">
              <div class="yoo-padd-lr-20">
                <div class="yoo-sidebar-search">
                  <form action="#" class="yoo-search yoo-style1 yoo-search-md">
                    <input type="text" placeholder="Search..." class="yoo-search-input" onkeyup="searchVH(this)" />
                    <button class="yoo-search-submit">
                      <ion-icon name="search" role="img" class="md hydrated" aria-label="search"></ion-icon>
                    </button>
                  </form>
                </div>
                <div style="
                      display: flex;
                      justify-content: space-around;
                      padding-top: 10px;
                    ">
                  <button type="button" ripple="ripple" ripple-color="#fff" class="btn btn-info"
                    onclick="location.href = '/createNew';">
                    Create new
                  </button>
                </div>
                <div class="yoo-height-b20 yoo-height-lg-b20"></div>

                <ul class="yoo-list-group yoo-style1 yoo-mp0" id="virtualhost_list">
                  <% for(var i = 0; i < virtualhosts.length; i++) { %>
                  <li>
                    <div class="yoo-medias yoo-style1">
                      <div class="yoo-media-img">
                        <img src="assets/img/virtualhost.png" alt="Virtualhost image" />
                      </div>
                      <div class="yoo-media-meta">
                        <h2 class="yoo-media-title yoo-margin-bottom-0">
                          <%= virtualhosts[i].domain %>
                        </h2>
                        <div class="yoo-media-subtitle">
                          <%= virtualhosts[i].vhConfigPath %>
                        </div>
                      </div>
                      <div style="display: flex; justify-content: flex-end;">
                        <button type="button" ripple="ripple" ripple-color="#fff" class="btn btn-danger btn-sm col-sm-2"
                          onclick="disableVH('<%= virtualhosts[i].fileName %>')">
                          Disable
                        </button>
                      </div>
                      <span class="yoo-media-tag"><%= virtualhosts[i].port %></span>
                    </div>
                  </li>
                  <% } %>
                </ul>
                <div class="yoo-height-b20 yoo-height-lg-b20"></div>
              </div>
            </div>
          </div>
          <!-- .yoo-card -->
          <div class="yoo-height-b30 yoo-height-lg-b30"></div>
        </div>
      </div>
    </div>
    <div class="yoo-height-b30 yoo-height-lg-b30"></div>
    <footer class="yoo-footer yoo-style1">
      <div class="container-fluid">
        <div class="yoo-footer-content">
          <div class="yoo-copyride">
            Made with coffee &amp; love by
            <a href="https://nullx.me/" target="_blank">nullx</a> ©All rights
            reserved.
          </div>

        </div>
      </div>
    </footer>
  </div>
  <!-- .yoo-content -->

  <!-- Required Scripts -->
  <script src="assets/js/jquery-1.12.4.min.js"></script>
  <script src="assets/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/iDashboard.js?v=0.06"></script>
  <script src="assets/js/ionicons/ionicons.js"></script>
  <script src="assets/js/toastr.min.js"></script>
  <script>
    const errors = <%- JSON.stringify(err) %>;
    if (errors.length > 0) {
      for (let i = 0; i < errors.length; i++) {
        const error = errors[i];
        if (error.length > 0) toastr.error(error)

      }
    }
    function searchVH(input) {
      var input, filter, ul, li, domain, i, txtValue;
      // input = document.getElementById("myInput");
      filter = input.value.toUpperCase();
      ul = document.getElementById("virtualhost_list");
      li = ul.children;
      for (i = 0; i < li.length; i++) {
        domain = li[i].getElementsByClassName("yoo-media-title yoo-margin-bottom-0")[0];
        domainValue = domain.textContent || domain.innerText;
        if (domainValue.toUpperCase().indexOf(filter) > -1) {
          li[i].style.display = "";
        } else {
          li[i].style.display = "none";
        }
      }
    }
    function disableVH(fileName) {
      var http = new XMLHttpRequest();
      var url = '/disableVH.post';
      var params = `fileName=${fileName}`;
      http.open('POST', url, true);

      http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

      http.onreadystatechange = function () {//Call a function when the state changes.
        if (http.readyState == 4 && http.status == 200) {
          proccessOutput(JSON.parse(http.responseText))
        }
      }
      http.send(params);
    }

    function proccessOutput(obj) {
      if (obj.err) {
        toastr.error(obj.err)

      } else if (obj.code == 0 && obj.msg) {
        toastr.success(obj.msg)
      }
    }

    function reloadApache() {
      toastr.info('Success', "Reloading apache2")
      var http = new XMLHttpRequest();
      var url = '/apache2Reload.post';
      http.open('POST', url, true);

      http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

      http.send();

    }
  </script>
</body>

</html>